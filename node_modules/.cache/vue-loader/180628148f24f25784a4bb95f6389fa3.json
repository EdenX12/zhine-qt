{"remainingRequest":"D:\\Work\\jianpanHt\\jpqt\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\Work\\jianpanHt\\jpqt\\src\\pages\\system\\basic\\MenuRole.vue?vue&type=style&index=0&id=32bfa862&lang=stylus&scoped=true&","dependencies":[{"path":"D:\\Work\\jianpanHt\\jpqt\\src\\pages\\system\\basic\\MenuRole.vue","mtime":1591608111912},{"path":"D:\\Work\\jianpanHt\\jpqt\\node_modules\\css-loader\\index.js","mtime":499162500000},{"path":"D:\\Work\\jianpanHt\\jpqt\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"D:\\Work\\jianpanHt\\jpqt\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"D:\\Work\\jianpanHt\\jpqt\\node_modules\\stylus-loader\\index.js","mtime":1519606876000},{"path":"D:\\Work\\jianpanHt\\jpqt\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\Work\\jianpanHt\\jpqt\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n.menurole-header\n    display flex\n    align-items center\n    text-align left\n    .input-left\n        width 250px\n    .input-right\n        width 250px\n        margin-left 5px\n    .add-button\n        margin-left 5px\n.menurole-body\n    text-align left \n    margin-top 10px\n    .body-collapse\n        width 500px\n        .delete-button\n            float right \n            color #f6061b\n            margin 0\n            padding 3px 0\n            width 15px\n            height 15px\n        .card-footer\n            display flex\n            justify-content flex-end\n            margin-right 10px\n            margin-top 10px\n",{"version":3,"sources":["MenuRole.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAmKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"MenuRole.vue","sourceRoot":"src/pages/system/basic","sourcesContent":["<template>\r\n    <div>\r\n        <div class=\"menurole-header\" v-loading=\"loading\">\r\n            <el-input \r\n            class=\"input-left\"\r\n            placeholder=\"请输入角色英文名称...\"\r\n            size=\"mini\"\r\n            v-model=\"newRole\">\r\n                <template slot=\"prepend\">ROLE_</template>\r\n            </el-input>\r\n            <el-input \r\n            class=\"input-right\"\r\n            placeholder=\"请输入角色中文名字...\"\r\n            size=\"mini\"\r\n            v-model=\"newRoleZh\"></el-input>\r\n            <el-button class=\"add-button\" type=\"primary\" size=\"mini\" @click=\"addNewRole\">添加角色</el-button>\r\n        </div>\r\n        <div class=\"menurole-body\">\r\n            <el-collapse class=\"body-collapse\" v-model=\"activeColItem\" accordion @change=\"collapseChange(activeColItem)\">\r\n                <!-- :name=\"item.id\"：就是 collapseChange(activeName) 中的activeName，属于 Element-UI collapse控件的回调函数 -->\r\n                <el-collapse-item v-for=\"(item, index) of roles\" :key=\"item.name\" :title=\"item.nameZh\" :name=\"item.id\">\r\n                    <el-card class=\"box-card\">\r\n                        <div slot=\"header\">\r\n                            <span>可访问的资源</span>\r\n                            <el-button class=\"delete-button\" type=\"text\" icon=\"el-icon-delete\" @click=\"deleteRole(item.id, item.nameZh)\"></el-button>\r\n                        </div>\r\n                        <div>\r\n                            <el-tree :props=\"props\"\r\n                            :data=\"treeData\"\r\n                            :default-checked-keys=\"checkedKeys\"\r\n                            node-key=\"id\"\r\n                            ref=\"tree\"\r\n                            show-checkbox\r\n                            highlight-current\r\n                            @check-change=\"handleCheckChange\"></el-tree>\r\n                        </div>\r\n                        <div class=\"card-footer\">\r\n                            <el-button size=\"mini\" @click=\"cancelUpdateRoleMenu\">取消修改</el-button>\r\n                            <el-button type=\"primary\" size=\"mini\" @click=\"updateRoleMenu(index)\">确认修改</el-button>\r\n                        </div>\r\n                    </el-card>\r\n                </el-collapse-item>\r\n            </el-collapse>\r\n        </div>\r\n    </div>\r\n</template>\r\n<script>\r\nimport { isNotNullOrBlank } from \"../../../utils/utils\"\r\nexport default {\r\n    name: \"MenuRole\",\r\n    data() {\r\n        return {\r\n            loading: false,\r\n            newRole: '',\r\n            newRoleZh: '',\r\n            roles: [],\r\n            activeColItem: -1,\r\n            treeData: [],\r\n            checkedKeys: [],\r\n            props: {\r\n                children: 'children',\r\n                label: 'name'\r\n            }\r\n        }\r\n    },\r\n    mounted() {\r\n        this.loading = true\r\n        this.initRoles()\r\n    },\r\n    methods: {\r\n        initRoles() {\r\n            var _this = this\r\n            this.getRequest(\"/system/basic/roles\")\r\n            .then(resp => {\r\n                _this.loading = false\r\n                if(resp && resp.status == 200) {\r\n                    _this.roles = resp.data.obj\r\n                    // 恢复折叠状态\r\n                    _this.activeColItem = -1\r\n                }\r\n            })\r\n        },\r\n        addNewRole () {\r\n            if (isNotNullOrBlank(this.newRole, this.newRoleZh)) {\r\n                this.loading = true\r\n                var _this = this\r\n                this.postRequest('/system/basic/addRole', {\r\n                    name: this.newRole,\r\n                    nameZh: this.newRoleZh\r\n                }).then(resp => {\r\n                    _this.loading = false\r\n                    if (resp && resp.status == 200) {\r\n                        _this.initRoles()\r\n                        _this.newRole = ''\r\n                        _this.newRoleZh = ''\r\n                    }\r\n                })\r\n            }\r\n        },\r\n        collapseChange (activeName) {\r\n            // 点击时，会获取每个item绑定的 name，而这里的 name 就是roleId\r\n            var roleId = activeName\r\n            if (activeName == '') {\r\n                return\r\n            }\r\n            var _this = this\r\n            this.getRequest(\"/system/basic/menuTree/\" + roleId)\r\n            .then(resp => {\r\n                if(resp && resp.status == 200) {\r\n                    var data = resp.data.obj\r\n                    _this.treeData = data.menus\r\n                    _this.checkedKeys = data.menuIds\r\n                }\r\n            })\r\n        },\r\n        deleteRole(roleId, roleNameZh) {\r\n            var _this = this\r\n            this.$confirm('删除角色[' + roleNameZh + ']，是否继续？', '提示', {\r\n                confirmButtonText: '确定',\r\n                cancelButtonText: '取消',\r\n                type: 'warning'\r\n            }).then(() => {\r\n                _this.loading = true\r\n                _this.deleteRequest('/system/basic/role/' + roleId)\r\n                .then(resp => {\r\n                    _this.loading = false\r\n                    if(resp && resp.status == 200) {\r\n                        _this.initRoles()\r\n                    }\r\n                })\r\n            }).catch(() => {\r\n                _this.$message({\r\n                    type: 'info',\r\n                    message: '已取消删除'\r\n                })\r\n            })\r\n        },\r\n        // eslint-disable-next-line no-unused-vars\r\n        handleCheckChange (data, checked, indeterminate) {},\r\n        cancelUpdateRoleMenu () {\r\n            // 恢复到折叠状态\r\n            this.activeColItem = -1\r\n        },\r\n        // 有多少个角色就有多少个树\r\n        updateRoleMenu (index) {\r\n            // getCheckedKeys(true)：表示只返回被选中的叶子结点的keys。由于我们设置了 node-key=\"id\"，\r\n            // 也就是数据源中的menu的id，所以这里能获取到所有被选中菜单的id集合\r\n            var checkedKeys = this.$refs.tree[index].getCheckedKeys(true)\r\n            var _this = this\r\n            this.putRequest(\"/system/basic/updateMenuRole\", {\r\n                roleId: this.activeColItem,\r\n                menuIds: checkedKeys\r\n            }).then(resp => {\r\n                if(resp && resp.status == 200) {\r\n                    // 恢复折叠状态\r\n                    _this.activeColItem = -1\r\n                }\r\n            })\r\n        }\r\n    },\r\n}\r\n</script>\r\n<style lang=\"stylus\" scoped>\r\n    .menurole-header\r\n        display flex\r\n        align-items center\r\n        text-align left\r\n        .input-left\r\n            width 250px\r\n        .input-right\r\n            width 250px\r\n            margin-left 5px\r\n        .add-button\r\n            margin-left 5px\r\n    .menurole-body\r\n        text-align left \r\n        margin-top 10px\r\n        .body-collapse\r\n            width 500px\r\n            .delete-button\r\n                float right \r\n                color #f6061b\r\n                margin 0\r\n                padding 3px 0\r\n                width 15px\r\n                height 15px\r\n            .card-footer\r\n                display flex\r\n                justify-content flex-end\r\n                margin-right 10px\r\n                margin-top 10px\r\n</style>"]}]}