{"remainingRequest":"D:\\Work\\jianpanHt\\jpqt\\node_modules\\babel-loader\\lib\\index.js!D:\\Work\\jianpanHt\\jpqt\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!D:\\Work\\jianpanHt\\jpqt\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\Work\\jianpanHt\\jpqt\\src\\pages\\system\\basic\\MenuRole.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\Work\\jianpanHt\\jpqt\\src\\pages\\system\\basic\\MenuRole.vue","mtime":1591608111912},{"path":"D:\\Work\\jianpanHt\\jpqt\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\Work\\jianpanHt\\jpqt\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"D:\\Work\\jianpanHt\\jpqt\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\Work\\jianpanHt\\jpqt\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { isNotNullOrBlank } from \"../../../utils/utils\";\nexport default {\n  name: \"MenuRole\",\n  data: function data() {\n    return {\n      loading: false,\n      newRole: '',\n      newRoleZh: '',\n      roles: [],\n      activeColItem: -1,\n      treeData: [],\n      checkedKeys: [],\n      props: {\n        children: 'children',\n        label: 'name'\n      }\n    };\n  },\n  mounted: function mounted() {\n    this.loading = true;\n    this.initRoles();\n  },\n  methods: {\n    initRoles: function initRoles() {\n      var _this = this;\n\n      this.getRequest(\"/system/basic/roles\").then(function (resp) {\n        _this.loading = false;\n\n        if (resp && resp.status == 200) {\n          _this.roles = resp.data.obj; // 恢复折叠状态\n\n          _this.activeColItem = -1;\n        }\n      });\n    },\n    addNewRole: function addNewRole() {\n      if (isNotNullOrBlank(this.newRole, this.newRoleZh)) {\n        this.loading = true;\n\n        var _this = this;\n\n        this.postRequest('/system/basic/addRole', {\n          name: this.newRole,\n          nameZh: this.newRoleZh\n        }).then(function (resp) {\n          _this.loading = false;\n\n          if (resp && resp.status == 200) {\n            _this.initRoles();\n\n            _this.newRole = '';\n            _this.newRoleZh = '';\n          }\n        });\n      }\n    },\n    collapseChange: function collapseChange(activeName) {\n      // 点击时，会获取每个item绑定的 name，而这里的 name 就是roleId\n      var roleId = activeName;\n\n      if (activeName == '') {\n        return;\n      }\n\n      var _this = this;\n\n      this.getRequest(\"/system/basic/menuTree/\" + roleId).then(function (resp) {\n        if (resp && resp.status == 200) {\n          var data = resp.data.obj;\n          _this.treeData = data.menus;\n          _this.checkedKeys = data.menuIds;\n        }\n      });\n    },\n    deleteRole: function deleteRole(roleId, roleNameZh) {\n      var _this = this;\n\n      this.$confirm('删除角色[' + roleNameZh + ']，是否继续？', '提示', {\n        confirmButtonText: '确定',\n        cancelButtonText: '取消',\n        type: 'warning'\n      }).then(function () {\n        _this.loading = true;\n\n        _this.deleteRequest('/system/basic/role/' + roleId).then(function (resp) {\n          _this.loading = false;\n\n          if (resp && resp.status == 200) {\n            _this.initRoles();\n          }\n        });\n      }).catch(function () {\n        _this.$message({\n          type: 'info',\n          message: '已取消删除'\n        });\n      });\n    },\n    // eslint-disable-next-line no-unused-vars\n    handleCheckChange: function handleCheckChange(data, checked, indeterminate) {},\n    cancelUpdateRoleMenu: function cancelUpdateRoleMenu() {\n      // 恢复到折叠状态\n      this.activeColItem = -1;\n    },\n    // 有多少个角色就有多少个树\n    updateRoleMenu: function updateRoleMenu(index) {\n      // getCheckedKeys(true)：表示只返回被选中的叶子结点的keys。由于我们设置了 node-key=\"id\"，\n      // 也就是数据源中的menu的id，所以这里能获取到所有被选中菜单的id集合\n      var checkedKeys = this.$refs.tree[index].getCheckedKeys(true);\n\n      var _this = this;\n\n      this.putRequest(\"/system/basic/updateMenuRole\", {\n        roleId: this.activeColItem,\n        menuIds: checkedKeys\n      }).then(function (resp) {\n        if (resp && resp.status == 200) {\n          // 恢复折叠状态\n          _this.activeColItem = -1;\n        }\n      });\n    }\n  }\n};",{"version":3,"sources":["MenuRole.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\r\n    <div>\r\n        <div class=\"menurole-header\" v-loading=\"loading\">\r\n            <el-input \r\n            class=\"input-left\"\r\n            placeholder=\"请输入角色英文名称...\"\r\n            size=\"mini\"\r\n            v-model=\"newRole\">\r\n                <template slot=\"prepend\">ROLE_</template>\r\n            </el-input>\r\n            <el-input \r\n            class=\"input-right\"\r\n            placeholder=\"请输入角色中文名字...\"\r\n            size=\"mini\"\r\n            v-model=\"newRoleZh\"></el-input>\r\n            <el-button class=\"add-button\" type=\"primary\" size=\"mini\" @click=\"addNewRole\">添加角色</el-button>\r\n        </div>\r\n        <div class=\"menurole-body\">\r\n            <el-collapse class=\"body-collapse\" v-model=\"activeColItem\" accordion @change=\"collapseChange(activeColItem)\">\r\n                <!-- :name=\"item.id\"：就是 collapseChange(activeName) 中的activeName，属于 Element-UI collapse控件的回调函数 -->\r\n                <el-collapse-item v-for=\"(item, index) of roles\" :key=\"item.name\" :title=\"item.nameZh\" :name=\"item.id\">\r\n                    <el-card class=\"box-card\">\r\n                        <div slot=\"header\">\r\n                            <span>可访问的资源</span>\r\n                            <el-button class=\"delete-button\" type=\"text\" icon=\"el-icon-delete\" @click=\"deleteRole(item.id, item.nameZh)\"></el-button>\r\n                        </div>\r\n                        <div>\r\n                            <el-tree :props=\"props\"\r\n                            :data=\"treeData\"\r\n                            :default-checked-keys=\"checkedKeys\"\r\n                            node-key=\"id\"\r\n                            ref=\"tree\"\r\n                            show-checkbox\r\n                            highlight-current\r\n                            @check-change=\"handleCheckChange\"></el-tree>\r\n                        </div>\r\n                        <div class=\"card-footer\">\r\n                            <el-button size=\"mini\" @click=\"cancelUpdateRoleMenu\">取消修改</el-button>\r\n                            <el-button type=\"primary\" size=\"mini\" @click=\"updateRoleMenu(index)\">确认修改</el-button>\r\n                        </div>\r\n                    </el-card>\r\n                </el-collapse-item>\r\n            </el-collapse>\r\n        </div>\r\n    </div>\r\n</template>\r\n<script>\r\nimport { isNotNullOrBlank } from \"../../../utils/utils\"\r\nexport default {\r\n    name: \"MenuRole\",\r\n    data() {\r\n        return {\r\n            loading: false,\r\n            newRole: '',\r\n            newRoleZh: '',\r\n            roles: [],\r\n            activeColItem: -1,\r\n            treeData: [],\r\n            checkedKeys: [],\r\n            props: {\r\n                children: 'children',\r\n                label: 'name'\r\n            }\r\n        }\r\n    },\r\n    mounted() {\r\n        this.loading = true\r\n        this.initRoles()\r\n    },\r\n    methods: {\r\n        initRoles() {\r\n            var _this = this\r\n            this.getRequest(\"/system/basic/roles\")\r\n            .then(resp => {\r\n                _this.loading = false\r\n                if(resp && resp.status == 200) {\r\n                    _this.roles = resp.data.obj\r\n                    // 恢复折叠状态\r\n                    _this.activeColItem = -1\r\n                }\r\n            })\r\n        },\r\n        addNewRole () {\r\n            if (isNotNullOrBlank(this.newRole, this.newRoleZh)) {\r\n                this.loading = true\r\n                var _this = this\r\n                this.postRequest('/system/basic/addRole', {\r\n                    name: this.newRole,\r\n                    nameZh: this.newRoleZh\r\n                }).then(resp => {\r\n                    _this.loading = false\r\n                    if (resp && resp.status == 200) {\r\n                        _this.initRoles()\r\n                        _this.newRole = ''\r\n                        _this.newRoleZh = ''\r\n                    }\r\n                })\r\n            }\r\n        },\r\n        collapseChange (activeName) {\r\n            // 点击时，会获取每个item绑定的 name，而这里的 name 就是roleId\r\n            var roleId = activeName\r\n            if (activeName == '') {\r\n                return\r\n            }\r\n            var _this = this\r\n            this.getRequest(\"/system/basic/menuTree/\" + roleId)\r\n            .then(resp => {\r\n                if(resp && resp.status == 200) {\r\n                    var data = resp.data.obj\r\n                    _this.treeData = data.menus\r\n                    _this.checkedKeys = data.menuIds\r\n                }\r\n            })\r\n        },\r\n        deleteRole(roleId, roleNameZh) {\r\n            var _this = this\r\n            this.$confirm('删除角色[' + roleNameZh + ']，是否继续？', '提示', {\r\n                confirmButtonText: '确定',\r\n                cancelButtonText: '取消',\r\n                type: 'warning'\r\n            }).then(() => {\r\n                _this.loading = true\r\n                _this.deleteRequest('/system/basic/role/' + roleId)\r\n                .then(resp => {\r\n                    _this.loading = false\r\n                    if(resp && resp.status == 200) {\r\n                        _this.initRoles()\r\n                    }\r\n                })\r\n            }).catch(() => {\r\n                _this.$message({\r\n                    type: 'info',\r\n                    message: '已取消删除'\r\n                })\r\n            })\r\n        },\r\n        // eslint-disable-next-line no-unused-vars\r\n        handleCheckChange (data, checked, indeterminate) {},\r\n        cancelUpdateRoleMenu () {\r\n            // 恢复到折叠状态\r\n            this.activeColItem = -1\r\n        },\r\n        // 有多少个角色就有多少个树\r\n        updateRoleMenu (index) {\r\n            // getCheckedKeys(true)：表示只返回被选中的叶子结点的keys。由于我们设置了 node-key=\"id\"，\r\n            // 也就是数据源中的menu的id，所以这里能获取到所有被选中菜单的id集合\r\n            var checkedKeys = this.$refs.tree[index].getCheckedKeys(true)\r\n            var _this = this\r\n            this.putRequest(\"/system/basic/updateMenuRole\", {\r\n                roleId: this.activeColItem,\r\n                menuIds: checkedKeys\r\n            }).then(resp => {\r\n                if(resp && resp.status == 200) {\r\n                    // 恢复折叠状态\r\n                    _this.activeColItem = -1\r\n                }\r\n            })\r\n        }\r\n    },\r\n}\r\n</script>\r\n<style lang=\"stylus\" scoped>\r\n    .menurole-header\r\n        display flex\r\n        align-items center\r\n        text-align left\r\n        .input-left\r\n            width 250px\r\n        .input-right\r\n            width 250px\r\n            margin-left 5px\r\n        .add-button\r\n            margin-left 5px\r\n    .menurole-body\r\n        text-align left \r\n        margin-top 10px\r\n        .body-collapse\r\n            width 500px\r\n            .delete-button\r\n                float right \r\n                color #f6061b\r\n                margin 0\r\n                padding 3px 0\r\n                width 15px\r\n                height 15px\r\n            .card-footer\r\n                display flex\r\n                justify-content flex-end\r\n                margin-right 10px\r\n                margin-top 10px\r\n</style>"],"sourceRoot":"src/pages/system/basic"}]}